<!DOCTYPE html>
<html class="light" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>P2P Hotels - Find your next stay</title>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#2beead",
              "background-light": "#ffffff",
              "background-dark": "#10221c",
              "text-main": "#222222",
              "text-secondary": "#717171",
              "border-light": "#dddddd",
            },
            fontFamily: {
              display: ["Plus Jakarta Sans", "sans-serif"],
              body: ["Plus Jakarta Sans", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "0.75rem",
              xl: "1.5rem",
              "2xl": "2rem",
              full: "9999px",
            },
            boxShadow: {
              card: "0 2px 4px rgba(0,0,0,0.08)",
              floating: "0 6px 16px rgba(0,0,0,0.12)",
            },
          },
        },
      };
    </script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/styles.css" />

    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark text-text-main dark:text-white antialiased min-h-screen flex flex-col"
  >
    <!-- Navbar -->
    <header
      class="sticky top-0 z-50 w-full bg-white dark:bg-background-dark border-b border-border-light dark:border-gray-800"
    >
      <div class="px-6 md:px-12 lg:px-20 mx-auto max-w-[1920px]">
        <div class="flex items-center justify-between h-20">
          <!-- Logo -->
          <a
            class="flex items-center gap-2 text-primary hover:opacity-80 transition-opacity"
            href="/"
          >
            <span class="material-symbols-outlined !text-4xl text-primary"
              >travel_explore</span
            >
            <span
              class="text-primary font-bold text-2xl tracking-tighter hidden md:block"
              >P2P Hotels</span
            >
          </a>

          <!-- Search Bar (Pill) -->
          <div
            class="hidden md:flex items-center bg-white dark:bg-gray-800 border border-border-light dark:border-gray-700 rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer py-2.5 pl-6 pr-2"
          >
            <input
              type="text"
              id="searchInput"
              class="text-sm font-semibold px-2 border-none bg-transparent focus:ring-0 text-text-main dark:text-white placeholder:text-text-secondary w-32"
              placeholder="Search hotels..."
            />
            <select
              id="cityFilter"
              class="text-sm font-semibold px-2 border-l border-gray-300 dark:border-gray-600 bg-transparent focus:ring-0 text-text-main dark:text-white"
            >
              <option value="">All cities</option>
              <option value="Marrakech">Marrakech</option>
              <option value="Casablanca">Casablanca</option>
              <option value="Rabat">Rabat</option>
              <option value="Agadir">Agadir</option>
            </select>
            <button
              onclick="applyFilters()"
              class="bg-primary p-2 rounded-full text-white flex items-center justify-center ml-2"
            >
              <span class="material-symbols-outlined !text-[16px] font-bold"
                >search</span
              >
            </button>
          </div>

          <!-- Right Actions -->
          <div class="flex items-center justify-end gap-2">
            <!-- Scraping Tool Button (logged in only) -->
            <button
              id="scrapingBtn"
              class="auth-logged-in hidden text-sm font-semibold px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors text-text-main dark:text-white items-center gap-2"
              onclick="openScrapingModal()"
            >
              <span class="material-symbols-outlined text-[18px]"
                >analytics</span
              >
              <span class="hidden lg:inline">Market Insights</span>
            </button>

            <!-- Add Property (logged in only) -->
            <a
              href="/add-hotel.html"
              class="auth-logged-in hidden text-sm font-semibold px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors lg:flex text-text-main dark:text-white"
            >
              Add Property
            </a>

            <!-- Language -->
            <button
              class="p-3 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors text-text-main dark:text-white"
            >
              <span class="material-symbols-outlined !text-[20px]"
                >language</span
              >
            </button>

            <!-- User Menu Dropdown -->
            <div class="relative" id="userMenuContainer">
              <button
                onclick="toggleUserMenu()"
                class="flex items-center gap-3 border border-border-light dark:border-gray-700 rounded-full p-1 pl-3 hover:shadow-md transition-shadow cursor-pointer ml-1 bg-white dark:bg-gray-800"
              >
                <span
                  class="material-symbols-outlined !text-[20px] text-text-main dark:text-white"
                  >menu</span
                >
                <div
                  class="bg-gray-500 rounded-full w-8 h-8 overflow-hidden flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-white text-[20px]"
                    >person</span
                  >
                </div>
              </button>

              <!-- Dropdown Menu -->
              <div
                id="userMenu"
                class="hidden absolute right-0 top-14 w-56 bg-white dark:bg-gray-800 border border-border-light dark:border-gray-700 rounded-xl shadow-floating overflow-hidden"
              >
                <!-- Logged out options -->
                <div class="auth-logged-out">
                  <a
                    href="/login.html"
                    class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 font-semibold"
                    >Log in</a
                  >
                  <a
                    href="/login.html?register=true"
                    class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >Sign up</a
                  >
                </div>

                <!-- Logged in options -->
                <div class="auth-logged-in hidden">
                  <div
                    class="px-4 py-3 border-b border-border-light dark:border-gray-700"
                  >
                    <p class="font-semibold user-name"></p>
                    <p class="text-sm text-text-secondary user-email"></p>
                  </div>
                  <a
                    href="/my-properties.html"
                    class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >My Properties</a
                  >
                  <a
                    href="/favorites.html"
                    class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >My Favorites</a
                  >
                  <a
                    href="/add-hotel.html"
                    class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >Add Property</a
                  >
                  <hr class="border-border-light dark:border-gray-700" />
                  <button
                    onclick="handleLogout()"
                    class="block w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-red-500"
                  >
                    Log out
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Categories Filter Bar -->
    <div
      class="sticky top-20 z-40 bg-white dark:bg-background-dark shadow-sm pt-4 pb-0"
    >
      <div class="px-6 md:px-12 lg:px-20 mx-auto max-w-[1920px]">
        <div
          class="flex items-center gap-8 overflow-x-auto hide-scrollbar pb-4"
        >
          <button
            onclick="filterByCategory('all')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-black dark:border-white pb-2"
            data-category="all"
          >
            <span
              class="material-symbols-outlined text-text-main dark:text-white !text-[24px]"
              >select_all</span
            >
            <span
              class="text-xs font-semibold text-text-main dark:text-white whitespace-nowrap"
              >All</span
            >
          </button>
          <button
            onclick="filterByCategory('beachfront')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-transparent hover:border-gray-200 dark:hover:border-gray-700 pb-2 transition-all opacity-70 hover:opacity-100"
            data-category="beachfront"
          >
            <span
              class="material-symbols-outlined text-text-secondary dark:text-gray-400 !text-[24px]"
              >beach_access</span
            >
            <span
              class="text-xs font-medium text-text-secondary dark:text-gray-400 whitespace-nowrap"
              >Beachfront</span
            >
          </button>
          <button
            onclick="filterByCategory('cabins')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-transparent hover:border-gray-200 dark:hover:border-gray-700 pb-2 transition-all opacity-70 hover:opacity-100"
            data-category="cabins"
          >
            <span
              class="material-symbols-outlined text-text-secondary dark:text-gray-400 !text-[24px]"
              >cabin</span
            >
            <span
              class="text-xs font-medium text-text-secondary dark:text-gray-400 whitespace-nowrap"
              >Cabins</span
            >
          </button>
          <button
            onclick="filterByCategory('trending')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-transparent hover:border-gray-200 dark:hover:border-gray-700 pb-2 transition-all opacity-70 hover:opacity-100"
            data-category="trending"
          >
            <span
              class="material-symbols-outlined text-text-secondary dark:text-gray-400 !text-[24px]"
              >local_fire_department</span
            >
            <span
              class="text-xs font-medium text-text-secondary dark:text-gray-400 whitespace-nowrap"
              >Trending</span
            >
          </button>
          <button
            onclick="filterByCategory('pools')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-transparent hover:border-gray-200 dark:hover:border-gray-700 pb-2 transition-all opacity-70 hover:opacity-100"
            data-category="pools"
          >
            <span
              class="material-symbols-outlined text-text-secondary dark:text-gray-400 !text-[24px]"
              >pool</span
            >
            <span
              class="text-xs font-medium text-text-secondary dark:text-gray-400 whitespace-nowrap"
              >Amazing Pools</span
            >
          </button>
          <button
            onclick="filterByCategory('luxury')"
            class="category-btn group flex flex-col items-center gap-2 min-w-[64px] cursor-pointer border-b-2 border-transparent hover:border-gray-200 dark:hover:border-gray-700 pb-2 transition-all opacity-70 hover:opacity-100"
            data-category="luxury"
          >
            <span
              class="material-symbols-outlined text-text-secondary dark:text-gray-400 !text-[24px]"
              >diamond</span
            >
            <span
              class="text-xs font-medium text-text-secondary dark:text-gray-400 whitespace-nowrap"
              >Luxury</span
            >
          </button>

          <!-- Status Filter -->
          <div class="ml-auto flex items-center gap-2">
            <select
              id="statusFilter"
              onchange="applyFilters()"
              class="text-sm border border-border-light dark:border-gray-700 rounded-lg px-3 py-2 bg-white dark:bg-gray-800 focus:ring-primary focus:border-primary"
            >
              <option value="">All Status</option>
              <option value="available">Available</option>
              <option value="full">Full</option>
            </select>
            <select
              id="starsFilter"
              onchange="applyFilters()"
              class="text-sm border border-border-light dark:border-gray-700 rounded-lg px-3 py-2 bg-white dark:bg-gray-800 focus:ring-primary focus:border-primary"
            >
              <option value="">All Stars</option>
              <option value="5">5 Stars</option>
              <option value="4">4 Stars</option>
              <option value="3">3 Stars</option>
              <option value="2">2 Stars</option>
              <option value="1">1 Star</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main
      class="flex-grow pt-6 px-6 md:px-12 lg:px-20 mx-auto max-w-[1920px] w-full pb-20"
    >
      <!-- Loading State -->
      <div id="loadingState" class="hidden">
        <div
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-5 gap-x-6 gap-y-10"
        >
          <!-- Skeleton cards -->
          <div class="animate-pulse">
            <div class="aspect-square bg-gray-200 rounded-xl mb-3"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
          <div class="animate-pulse">
            <div class="aspect-square bg-gray-200 rounded-xl mb-3"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
          <div class="animate-pulse">
            <div class="aspect-square bg-gray-200 rounded-xl mb-3"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
          <div class="animate-pulse">
            <div class="aspect-square bg-gray-200 rounded-xl mb-3"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden empty-state">
        <span class="material-symbols-outlined icon">hotel</span>
        <h3 class="text-xl font-bold text-text-main dark:text-white mb-2">
          No hotels found
        </h3>
        <p class="text-text-secondary dark:text-gray-400 mb-4">
          Try adjusting your search or filters
        </p>
        <button
          onclick="clearFilters()"
          class="bg-primary text-[#111816] font-bold px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors"
        >
          Clear Filters
        </button>
      </div>

      <!-- Hotels Grid -->
      <div
        id="hotelsGrid"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-5 gap-x-6 gap-y-10"
      >
        <!-- Hotel cards will be inserted here -->
      </div>

      <!-- Pagination -->
      <div id="paginationContainer"></div>
    </main>

    <!-- Scraping Modal -->
    <div id="scrapingModal" class="modal-backdrop">
      <div
        class="relative w-full max-w-[520px] bg-white dark:bg-background-dark rounded-2xl shadow-2xl transform transition-all flex flex-col overflow-hidden ring-1 ring-black/5 mx-4"
      >
        <!-- Modal Header -->
        <div class="px-8 pt-8 pb-2 flex justify-between items-start">
          <div class="flex flex-col gap-1">
            <div class="flex items-center gap-2 mb-2">
              <span
                class="bg-primary/20 text-[#0d4e3a] dark:text-primary p-1.5 rounded-lg"
              >
                <span class="material-symbols-outlined text-[20px]"
                  >analytics</span
                >
              </span>
              <span
                class="text-xs font-bold tracking-wider text-primary uppercase"
                >Market Tool</span
              >
            </div>
            <h2
              class="text-text-main dark:text-white text-[28px] font-bold leading-tight tracking-tight"
            >
              Market Insights
            </h2>
          </div>
          <button
            onclick="closeScrapingModal()"
            class="text-text-secondary hover:text-text-main dark:hover:text-white transition-colors rounded-full p-2 hover:bg-gray-100 dark:hover:bg-[#1e3a32]"
          >
            <span class="material-symbols-outlined text-[24px]">close</span>
          </button>
        </div>

        <!-- Modal Body -->
        <div class="px-8 pb-6">
          <p
            class="text-text-secondary dark:text-gray-400 text-base font-normal leading-normal"
          >
            Find hotels in your area to analyze market competition. Results will
            be exported to Google Sheets.
          </p>
        </div>

        <!-- Modal Form -->
        <form id="scrapingForm" class="px-8 flex flex-col gap-5">
          <label class="flex flex-col gap-2 group">
            <span
              class="text-text-main dark:text-white text-sm font-semibold leading-normal"
              >Enter City</span
            >
            <div class="relative flex items-center">
              <span
                class="material-symbols-outlined absolute left-4 text-text-secondary pointer-events-none"
                >location_on</span
              >
              <input
                type="text"
                id="scrapingCity"
                required
                class="w-full rounded-xl border border-border-light dark:border-[#2a453c] bg-gray-50 dark:bg-[#152a24] h-14 pl-12 pr-4 text-base text-text-main dark:text-white placeholder:text-text-secondary focus:ring-2 focus:ring-primary focus:border-primary transition-all shadow-sm"
                placeholder="e.g. Marrakech"
              />
            </div>
          </label>

          <label class="flex flex-col gap-2 group">
            <span
              class="text-text-main dark:text-white text-sm font-semibold leading-normal"
              >Enter Keyword</span
            >
            <div class="relative flex items-center">
              <span
                class="material-symbols-outlined absolute left-4 text-text-secondary pointer-events-none"
                >key</span
              >
              <input
                type="text"
                id="scrapingKeyword"
                required
                class="w-full rounded-xl border border-border-light dark:border-[#2a453c] bg-gray-50 dark:bg-[#152a24] h-14 pl-12 pr-4 text-base text-text-main dark:text-white placeholder:text-text-secondary focus:ring-2 focus:ring-primary focus:border-primary transition-all shadow-sm"
                placeholder="e.g. luxury hotel, riad"
                value="hotel"
              />
            </div>
          </label>
        </form>

        <!-- Modal Footer -->
        <div class="p-8 pt-6 mt-2">
          <button
            type="submit"
            form="scrapingForm"
            onclick="triggerScrapingWorkflow(event)"
            class="group relative w-full flex items-center justify-center gap-3 bg-primary hover:bg-[#25dcb8] active:bg-[#1ebf9f] text-[#10221c] font-bold text-lg h-14 rounded-xl transition-all shadow-lg shadow-primary/20 hover:shadow-primary/40 transform hover:-translate-y-0.5"
          >
            <span class="material-symbols-outlined">search</span>
            <span>Run Analysis</span>
          </button>
          <div
            class="mt-4 flex items-center justify-center gap-2 text-text-secondary dark:text-gray-500 text-sm"
          >
            <span class="material-symbols-outlined text-[18px]"
              >table_view</span
            >
            <p>
              Results will open in
              <span class="font-medium text-text-main dark:text-white"
                >Google Sheets</span
              >
            </p>
          </div>
        </div>

        <!-- Decorative gradient line -->
        <div
          class="h-1.5 w-full bg-gradient-to-r from-primary/40 via-primary to-primary/40"
        ></div>
      </div>
    </div>

    <!-- Simple Footer -->
    <footer
      class="bg-gray-100 dark:bg-gray-900 border-t border-border-light dark:border-gray-800 py-8 px-6 md:px-12 lg:px-20 mt-auto"
    >
      <div
        class="max-w-[1920px] mx-auto flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-text-secondary dark:text-gray-400"
      >
        <div class="flex flex-wrap gap-4 justify-center md:justify-start">
          <span>© 2024 P2P Hotels, Inc.</span>
          <span class="hidden md:inline">·</span>
          <a class="hover:underline" href="#">Privacy</a>
          <span class="hidden md:inline">·</span>
          <a class="hover:underline" href="#">Terms</a>
          <span class="hidden md:inline">·</span>
          <a class="hover:underline" href="#">Sitemap</a>
        </div>
        <div class="flex gap-6 items-center">
          <div
            class="flex items-center gap-2 cursor-pointer font-medium hover:underline"
          >
            <span class="material-symbols-outlined !text-[16px]">language</span>
            <span>English (US)</span>
          </div>
          <div
            class="flex items-center gap-2 cursor-pointer font-medium hover:underline"
          >
            <span>$</span>
            <span>USD</span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/hotels.js"></script>
    <script>
      // State
      let currentPage = 1;
      let currentFilters = {};

      // Initialize
      document.addEventListener("DOMContentLoaded", async () => {
        updateAuthUI();
        await loadHotels();
      });

      // Load hotels
      async function loadHotels() {
        const grid = document.getElementById("hotelsGrid");
        const loading = document.getElementById("loadingState");
        const empty = document.getElementById("emptyState");

        // Show loading
        grid.innerHTML = "";
        loading.classList.remove("hidden");
        empty.classList.add("hidden");

        // Build params
        const params = {
          page: currentPage,
          limit: 6,
          ...currentFilters,
        };

        const result = await api.getHotels(params);

        // Hide loading
        loading.classList.add("hidden");

        if (result.ok && result.data.data.length > 0) {
          // Render hotels
          grid.innerHTML = result.data.data
            .map((hotel) => createHotelCard(hotel))
            .join("");

          // Render pagination
          document.getElementById("paginationContainer").innerHTML =
            createPagination(result.data.pagination);
        } else {
          // Show empty state
          empty.classList.remove("hidden");
        }
      }

      // Change page
      function changePage(page) {
        currentPage = page;
        loadHotels();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Apply filters
      function applyFilters() {
        currentPage = 1;
        currentFilters = {
          search: document.getElementById("searchInput").value,
          city: document.getElementById("cityFilter").value,
          status: document.getElementById("statusFilter").value,
          stars: document.getElementById("starsFilter").value,
        };

        // Remove empty values
        Object.keys(currentFilters).forEach((key) => {
          if (!currentFilters[key]) delete currentFilters[key];
        });

        loadHotels();
      }

      // Clear filters
      function clearFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("cityFilter").value = "";
        document.getElementById("statusFilter").value = "";
        document.getElementById("starsFilter").value = "";
        currentFilters = {};
        currentPage = 1;
        loadHotels();
      }

      // Filter by category
      function filterByCategory(category) {
        // Update active state
        document.querySelectorAll(".category-btn").forEach((btn) => {
          const isActive = btn.dataset.category === category;
          btn.classList.toggle("border-black", isActive);
          btn.classList.toggle("dark:border-white", isActive);
          btn.classList.toggle("border-transparent", !isActive);
          btn.classList.toggle("opacity-70", !isActive);
        });

        // Categories are just UI for now, could map to amenities later
        currentPage = 1;
        loadHotels();
      }

      // Toggle user menu
      function toggleUserMenu() {
        document.getElementById("userMenu").classList.toggle("hidden");
      }

      // Close menu when clicking outside
      document.addEventListener("click", (e) => {
        if (!document.getElementById("userMenuContainer").contains(e.target)) {
          document.getElementById("userMenu").classList.add("hidden");
        }
      });

      // Scraping modal
      function openScrapingModal() {
        document.getElementById("scrapingModal").classList.add("show");
      }

      function closeScrapingModal() {
        document.getElementById("scrapingModal").classList.remove("show");
      }

      async function triggerScrapingWorkflow(e) {
        e.preventDefault();

        const city = document.getElementById("scrapingCity").value;
        const keyword = document.getElementById("scrapingKeyword").value;

        if (!city || !keyword) {
          showToast("Please fill in all fields", "error");
          return;
        }

        const btn = e.target.closest("button");
        btn.disabled = true;
        btn.innerHTML = '<div class="spinner"></div><span>Running...</span>';

        const result = await api.triggerScraping(city, keyword);

        btn.disabled = false;
        btn.innerHTML =
          '<span class="material-symbols-outlined">search</span><span>Run Analysis</span>';

        if (result.ok && result.data.success) {
          showToast("Analysis complete!", "success");
          if (result.data.sheetUrl) {
            window.open(result.data.sheetUrl, "_blank");
          }
          closeScrapingModal();
        } else {
          showToast(result.data.message || "Failed to run analysis", "error");
        }
      }

      // Enter key for search
      document
        .getElementById("searchInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") applyFilters();
        });
    </script>
  </body>
</html>
